## 在渲染的执行阶段在什么时候

---
### 渲染任务的执行条件
1. **页面触发了变更，需要渲染**  
   渲染任务只会在 DOM 或样式发生变更时触发，浏览器会将这些变更记录为“脏数据”，并在下一次渲染任务中统一处理。

2. **渲染的固定时机（每 16ms）**  
   - 浏览器的渲染频率通常是 **60 帧/秒**，每帧间隔约 **16.6ms**。  
   - 到达帧间隔时，浏览器会尝试进行渲染任务。如果主线程被占用，则渲染会延迟到主线程空闲时再执行。

3. **渲染任务的优先级和时机**  
   - 渲染任务插入到事件循环的“空闲时间”中执行。  
   - 如果一个事件（如宏任务或微任务）正在执行且未完成，渲染任务必须等待该事件完成，**渲染任务不会打断当前任务的执行**。  
   - 当主线程空闲时，即使事件队列未清空，只要渲染时机到了，渲染任务也会插队执行。

---

### 总结修订版

渲染任务的执行需满足以下条件：  
1. **变更触发**：页面发生了 DOM 或样式的变更。  
2. **帧时间间隔**：渲染任务默认每 16ms 尝试执行一次，但可能因主线程阻塞而延迟。  
3. **主线程空闲**：渲染任务插入事件循环，只有当当前的事件执行完毕后才能开始执行。

---

### 额外说明

即使你代码中触发了多次 DOM 变更，浏览器也可能会合并这些变更，在下一次渲染时一起处理。这种优化称为 **渲染批处理（batch rendering）**，目的是提升性能并减少不必要的重排重绘。